package ming;

import java.lang.reflect.Method;
import java.util.ArrayList;
import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.log4j.Logger;
import org.springframework.web.servlet.ModelAndView;
import org.springframework.web.servlet.mvc.multiaction.MultiActionController;

public class ProductController extends MultiActionController {
	Logger log = Logger.getLogger(ProductController.class);
	public ModelAndView viewHandler(HttpServletRequest req, HttpServletResponse resp) throws Exception{
		resp.getOutputStream().println("viewing product " + req.getParameter("productId"));
		return null;
	}
	
	public ModelAndView tableformHandler(HttpServletRequest req, HttpServletResponse resp) throws Exception{
		String className = req.getParameter("className");
		Class beanClass = Class.forName(className);
		Object bean = null;
		Method[] methods = beanClass.getDeclaredMethods();
		String methodName,paramValues[];
		boolean hasMoreValue = true;
		List<Object> paramList = new ArrayList<Object>();
		for ( int outer = 0; outer < 50 && hasMoreValue; outer++){
			bean = beanClass.newInstance();
			for ( int i = 0; i < methods.length; i++){
				methodName = methods[i].getName();
				if ( methodName.startsWith("set")){
					methodName = methodName.substring(3,4).toLowerCase() + methodName.substring(4);
					paramValues = req.getParameterValues(methodName);
					if ( null != paramValues){
						if (paramValues.length > outer){
							methods[i].invoke(bean, paramValues[outer]);
						} else {
							hasMoreValue=false;
							break;
						}
					}
				}
			}
			if (hasMoreValue){
				paramList.add(bean);
			}
		}
		
		log.debug(paramList);
		return null;
	}
	
	public ModelAndView platformTransactionHandler(HttpServletRequest req, HttpServletResponse resp) throws Exception{
		
		return null;
	}
}
